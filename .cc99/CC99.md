# cc99

## Project Overview

cc99 is a Neovim plugin that provides scoped AI-assisted code editing powered by Claude Code CLI. Users select code in visual mode, describe desired changes in a floating prompt window, and Claude replaces the selected code automatically. Claude is given read-only tool access (Read, Grep, Glob, LS) to explore the codebase intelligently rather than embedding entire files in prompts. Execution is asynchronous and non-blocking, with streaming status displayed via extmark virtual lines.

## Languages / Frameworks

- **Language:** Lua
- **Platform:** Neovim 0.10+ (Lua API: `vim.api`, `vim.system`)
- **External Dependency:** Claude Code CLI (subprocess invocation)
- **Prompt Templates:** Markdown

## Directory Structure

```
.cc99/
  prompts/
    analyze.md          # Prompt template for project analysis
    system.md           # System prompt for code replacement
  CC99.md               # Generated project context (this file)
lua/cc99/
  init.lua              # Entry point (delegates to v2)
  v1/                   # Legacy implementation (replaced by v2)
    init.lua / claude.lua / fs.lua / mark.lua /
    options.lua / prompt.lua / request.lua / text_stream_buffer.lua
  v2/                   # Current implementation
    init.lua            # Setup & command/keybinding registration
    api.lua             # Public API (open/close/exec float, analyze)
    domain/init.lua     # Domain models (Prompt, Context)
    service/init.lua    # ProviderService (Claude CLI wrapper, Observer pattern)
    ui/init.lua         # UI primitives (V2Point, V2Range, V2Mark, V2Float)
    fs/init.lua         # Filesystem utilities (project root, path helpers)
.editorconfig           # 2-space indent for Lua
.luarc.json             # Lua LSP settings (vim globals, test globals)
README.md               # User documentation
TODO.md                 # Feature roadmap
```

## Key Files

| File | Role |
|------|------|
| `lua/cc99/v2/api.lua` | Core business logic: float management, context building, code replacement |
| `lua/cc99/v2/service/init.lua` | Async subprocess execution with Observer callbacks (on_stdout/stderr/exit) |
| `lua/cc99/v2/ui/init.lua` | Value objects for UI: Point, Range, Mark (extmark wrapper), Float (prompt window) |
| `lua/cc99/v2/domain/init.lua` | Domain models: Prompt (system/user text), Context (prompt + code + analysis) |
| `lua/cc99/v2/fs/init.lua` | Project root detection, file reading, path construction |
| `lua/cc99/v2/init.lua` | Plugin setup: registers commands (`<leader>ccm`, `<leader>ccq`, `<leader>ccx`) |
| `.cc99/prompts/system.md` | System prompt defining Claude's code replacement rules |
| `.cc99/prompts/analyze.md` | Template for auto-generating project analysis on first run |
